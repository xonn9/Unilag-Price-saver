<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>UNILAG Price Saver - Dashboard</title>

  <!-- Google Maps script (keep your key) -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA1234567890&libraries=places" async defer></script>

  <!-- Extracted CSS -->
  <link rel="stylesheet" href="/static/css/user-dashboard.css">
</head>
<body>
  <header>
    <button class="nav-toggle" id="navToggleBtn" title="Navigation">â˜°</button>
    <div class="logo">ğŸ›’ UNILAG Price Saver</div>
    <div class="header-actions">
      <span id="user-info">User: Student</span>
      <button class="dark-mode-toggle" id="darkModeBtn" title="Toggle dark mode">ğŸŒ™</button>
    </div>
  </header>

  <div class="nav-overlay" id="navOverlay" aria-hidden="true"></div>

  <nav class="nav-panel" id="navPanel" aria-hidden="true">
    <h3>ğŸ“± Navigation</h3>
    <a href="user-dashboard.html" class="nav-item" data-action="home">ğŸ“Š Dashboard</a>
    <button class="nav-item" data-action="trends">ğŸ“ˆ Trends</button>
    <button class="nav-item" data-action="insights">ğŸ“Š Category Insights</button>
    <button class="nav-item" data-action="alerts">ğŸ”” My Alerts</button>
    <button class="nav-item" data-action="profile">ğŸ‘¤ Profile</button>
    <button class="nav-item" data-action="logout">ğŸšª Logout</button>
  </nav>

  <!-- Location Picker Modal -->
  <div class="location-modal" id="locationModal" aria-hidden="true">
    <div class="location-modal-content" role="dialog" aria-modal="true" aria-labelledby="locationModalTitle">
      <div class="location-modal-header">
        <h3 id="locationModalTitle">ğŸ“ Pick Location</h3>
        <button class="location-modal-close" id="locationModalClose" aria-label="Close">Ã—</button>
      </div>
      <div class="location-modal-body">
        <div class="location-info">ğŸ’¡ Click on the map to select a location or search for a place below</div>

        <div class="location-input-group">
          <label for="locationSearch">Search Location</label>
          <input type="text" id="locationSearch" placeholder="e.g., UNILAG, Shoprite Ikeja, Lekki" autocomplete="off">
          <div class="autocomplete-list" id="autocompleteList" aria-live="polite"></div>
        </div>

        <div id="map" role="region" aria-label="Map"></div>

        <div class="location-coordinates" id="locationCoordinates" aria-hidden="true">
          <p><strong>Selected Location:</strong></p>
          <p id="selectedAddress">-</p>
          <p>Latitude: <span id="selectedLat">-</span></p>
          <p>Longitude: <span id="selectedLng">-</span></p>
        </div>

        <div class="location-input-group">
          <label for="manualLocation">Or Enter Location Manually</label>
          <input type="text" id="manualLocation" placeholder="e.g., Main Campus, Federal College Road">
        </div>
      </div>
      <div class="location-modal-footer">
        <button class="btn-secondary" id="locationModalCancel">Cancel</button>
        <button class="btn-primary" id="locationModalConfirm">Confirm Location</button>
      </div>
    </div>
  </div>

  <div class="container">
    <aside class="sidebar">
      <h2>Submit Price</h2>
      <div class="success-message" id="successMsg" role="status">âœ… Price submitted successfully!</div>

      <div class="form-section">
        <form id="priceForm" novalidate>
          <div class="form-group">
            <label for="category">Category <span class="required">*</span></label>
            <select id="category" required>
              <option value="">Select category...</option>
            </select>
          </div>

          <div class="form-group">
            <label for="itemName">Item Name <span class="required">*</span></label>
            <input type="text" id="itemName" placeholder="e.g., Rice, Peak Milk" required>
          </div>

          <div class="form-group">
            <label for="brand">Brand</label>
            <input type="text" id="brand" placeholder="e.g., Peak, Farmer's Choice">
          </div>

          <div class="form-group">
            <label for="packSize">Pack Size</label>
            <input type="text" id="packSize" placeholder="e.g., 500, 1000">
          </div>

          <div class="form-group">
            <label for="packUnit">Pack Unit</label>
            <select id="packUnit">
              <option value="">Select unit...</option>
              <option value="g">Grams (g)</option>
              <option value="kg">Kilograms (kg)</option>
              <option value="ml">Milliliters (ml)</option>
              <option value="L">Liters (L)</option>
              <option value="pcs">Pieces (pcs)</option>
              <option value="pack">Pack</option>
            </select>
          </div>

          <div class="form-group">
            <label for="price">Price (â‚¦) <span class="required">*</span></label>
            <input type="number" id="price" step="0.01" placeholder="Enter price" required>
          </div>

          <div class="form-group">
            <label for="pricePerUnit">Price Per Unit (â‚¦)</label>
            <input type="number" id="pricePerUnit" step="0.01" placeholder="Calculated per 100g/ml">
          </div>

          <div class="form-group">
            <label for="retailer">Retailer</label>
            <input type="text" id="retailer" placeholder="Store/Shop name">
          </div>

          <div class="form-group">
            <label for="location">Location</label>
            <div class="flex-row">
              <input type="text" id="location" placeholder="Area/Campus location" style="flex:1;" aria-label="Selected location">
              <button type="button" id="mapPickerBtn" class="btn-success" title="Pick location from map">ğŸ“</button>
            </div>
          </div>

          <button type="submit" id="submitPriceBtn">Submit Price</button>
        </form>
      </div>
    </aside>

    <main class="main">
      <div class="stats-cards">
        <div class="stat-card"><h4>Total Prices</h4><div class="number" id="totalPrices">0</div></div>
        <div class="stat-card"><h4>Average Price</h4><div class="number" id="avgPrice">â‚¦0</div></div>
        <div class="stat-card"><h4>Locations</h4><div class="number" id="totalLocations">0</div></div>
        <div class="stat-card"><h4>Retailers</h4><div class="number" id="totalRetailers">0</div></div>
      </div>

      <section class="filters">
        <h3>ğŸ” Filters</h3>
        <div class="search-autocomplete" style="margin-bottom:1rem;">
          <input type="text" id="globalSearch" class="search-autocomplete-input" placeholder="ğŸ” Search items, retailers, locations..." autocomplete="off">
          <div class="search-results" id="searchResults" aria-live="polite"></div>
        </div>

        <div class="filter-grid">
          <div><label for="filterCategory">Category</label><select id="filterCategory"><option value="">All Categories</option></select></div>
          <div><label for="filterMinPrice">Min Price (â‚¦)</label><input type="number" id="filterMinPrice" placeholder="0" step="0.01"></div>
          <div><label for="filterMaxPrice">Max Price (â‚¦)</label><input type="number" id="filterMaxPrice" placeholder="999999" step="0.01"></div>
          <div><label for="filterRetailer">Retailer</label><input type="text" id="filterRetailer" placeholder="Search retailer..."></div>
          <div><label for="filterLocation">Location</label><input type="text" id="filterLocation" placeholder="Search location..."></div>
          <div><label>&nbsp;</label><button class="secondary" id="resetFiltersBtn">Reset Filters</button></div>
        </div>
      </section>

      <section class="prices-section">
        <h3>ğŸ“Š Current Prices</h3>
        <div id="pricesContainer"><div class="empty-state"><p>No prices available yet. Start by submitting a price above!</p></div></div>
      </section>
    </main>
  </div>

  <!-- Mobile Bottom Navigation -->
  <nav class="mobile-bottom-nav" id="mobileBottomNav" aria-hidden="true">
    <button class="mobile-nav-item active" data-action="home"><span>ğŸ </span><span>Home</span></button>
    <button class="mobile-nav-item" data-action="trends"><span>ğŸ“ˆ</span><span>Trends</span></button>
    <button class="mobile-nav-item" data-action="submit"><span>ğŸ’°</span><span>Submit</span></button>
    <button class="mobile-nav-item" data-action="map"><span>ğŸ—ºï¸</span><span>Map</span></button>
    <button class="mobile-nav-item" data-action="profile"><span>ğŸ‘¤</span><span>Profile</span></button>
  </nav>

  <!-- Alert Modal -->
  <div class="alert-modal" id="alertModal" aria-hidden="true">
    <div class="alert-modal-content" role="dialog" aria-modal="true">
      <h3 class="modal-title">ğŸ”” Set Price Alert</h3>
      <div class="form-group"><label>Item Name</label><input type="text" id="alertItemName" readonly></div>
      <div class="form-group"><label>Notify me when price is below (â‚¦)</label><input type="number" id="alertThreshold" step="0.01"></div>
      <div class="modal-actions"><button class="secondary" id="alertCancelBtn">Cancel</button><button id="alertSaveBtn">Save Alert</button></div>
    </div>
  </div>

  <!-- Retailer Modal -->
  <div class="retailer-modal" id="retailerModal" aria-hidden="true">
    <div class="retailer-modal-content" role="dialog" aria-modal="true">
      <div class="retailer-header"><div><span class="retailer-name" id="retailerProfileName">-</span> <span class="verified-badge" id="retailerVerified" style="display:none;">âœ“ Verified</span></div><button id="retailerCloseBtn" aria-label="Close">Ã—</button></div>
      <div class="retailer-stats" id="retailerStats"></div>
      <div class="category-insight-card"><h4>ğŸ’° Cheapest Items</h4><div id="retailerCheapestItems"></div></div>
      <div class="category-insight-card"><h4>ğŸ”¥ Top Items</h4><div id="retailerTopItems"></div></div>
    </div>
  </div>

  <!-- Category Insights Modal -->
  <div class="alert-modal" id="categoryInsightsModal" aria-hidden="true">
    <div class="alert-modal-content">
      <div class="modal-header"><h3>ğŸ“Š Category Insights</h3><button id="categoryInsightsClose">Ã—</button></div>
      <div id="categoryInsightsContent"></div>
    </div>
  </div>

  <!-- Profile Modal -->
  <div class="alert-modal" id="profileModal" aria-hidden="true">
    <div class="alert-modal-content">
      <div class="modal-header"><h3>ğŸ‘¤ My Profile</h3><button id="profileCloseBtn">Ã—</button></div>
      <div id="profileContent"></div>
    </div>
  </div>

  <!-- Main JS entry (ES module) -->
  <script type="module" src="/static/js/user-dashboard.js"></script>
</body>
</html>
